{% extends 'base.html' %}
{% block title %}Student Dashboard{% endblock %}

{% block content %}
<h3 class="mb-4">Welcome, {{ request.user.username }}</h3>

<!-- Attendance Table -->
<div class="card p-4 mb-5">
  <h5 class="mb-3">Attendance Summary</h5>

  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Subject</th>
        <th>Total Classes</th>
        <th>Present</th>
        <th>Attendance %</th>
      </tr>
    </thead>
    <tbody>
      {% for data in subject_data %}
      <tr>
        <td>{{ data.subject }}</td>
        <td>{{ data.total }}</td>
        <td>{{ data.present }}</td>
        <td>
          <span class="badge
            {% if data.percentage >= 75 %}
              bg-success
            {% elif data.percentage >= 50 %}
              bg-warning
            {% else %}
              bg-danger
            {% endif %}
          ">
            {{ data.percentage }}%
          </span>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Attendance Chart -->
<div class="card p-4">
  <h5 class="mb-3">Attendance Chart</h5>
  <canvas id="attendanceChart"></canvas>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const ctx = document.getElementById('attendanceChart');

  const attendanceChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: [
        {% for data in subject_data %}
          "{{ data.subject }}",
        {% endfor %}
      ],
      datasets: [{
        label: 'Attendance Percentage',
        data: [
          {% for data in subject_data %}
            {{ data.percentage }},
          {% endfor %}
        ],
        backgroundColor: '#3b82f6'
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true,
          max: 100
        }
      }
    }
  });
</script>
{% endblock %}
