{% extends 'base.html' %}
{% block title %}Teacher Dashboard{% endblock %}

{% block content %}
<h4 class="mb-4">Mark Attendance</h4>

<!-- FILTER FORM -->
<form method="get" class="card p-3 mb-4">
  <div class="row">

    <div class="col-md-3">
      <label class="form-label">Date</label>
      <input
        type="date"
        name="date"
        class="form-control"
        value="{{ selected_date }}"
        required
      >
    </div>

    <div class="col-md-3">
      <label class="form-label">Class</label>
      <select name="class_code" class="form-control" required>
        <option value="">-- Select Class --</option>
        {% for cls in teacher.classes.all %}
          <option value="{{ cls.code }}"
            {% if cls.code == selected_class %}selected{% endif %}
          >
            {{ cls }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-3">
      <label class="form-label">Subject</label>
      <select class="form-control" disabled>
        <option>{{ teacher.subject.name }}</option>
      </select>
    </div>

    <div class="col-md-3 d-flex align-items-end">
      <button class="btn btn-primary w-100">
        Load Students
      </button>
    </div>

  </div>
</form>

{% if students %}

{% if not can_edit %}
<div class="alert alert-warning">
  Attendance can only be edited within <strong>24 hours</strong>.
</div>
{% endif %}

<div class="alert alert-info">
  <strong>Total Students:</strong> {{ students|length }}
</div>

<form method="post">
  {% csrf_token %}
  <input type="hidden" name="date" value="{{ selected_date }}">
  <input type="hidden" name="class_code" value="{{ selected_class }}">

  <table class="table table-bordered">
    <thead>
      <tr>
        <th>#</th>
        <th>Student Name</th>
        <th>Present</th>
      </tr>
    </thead>
    <tbody>
      {% for student in students %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ student.user.username }}</td>
        <td class="text-center">
          <input
            type="checkbox"
            name="present_students"
            value="{{ student.id }}"
            {% if not can_edit %}disabled{% endif %}
          >
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <button
    class="btn btn-success w-100"
    {% if not can_edit %}disabled{% endif %}
  >
    Submit Attendance
  </button>
</form>

{% endif %}
{% endblock %}
