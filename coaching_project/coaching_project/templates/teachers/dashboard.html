{% extends 'base.html' %}
{% block title %}Teacher Dashboard{% endblock %}

{% block content %}
<h4 class="mb-4">Mark Attendance</h4>

<!-- FILTER FORM -->
<form method="get" class="card p-3 mb-4">
  <div class="row">

    <div class="col-md-4">
      <label>Date</label>
      <input type="date" name="date" class="form-control"
             value="{{ selected_date }}" required>
    </div>

    <div class="col-md-4">
      <label>Subject</label>
      <select name="subject" class="form-control" required>
        <option value="">-- Select Subject --</option>
        {% for sub in subjects %}
          <option value="{{ sub.id }}"
            {% if sub.id|stringformat:"s" == selected_subject %}
              selected
            {% endif %}
          >
            {{ sub.name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-4 d-flex align-items-end">
      <button class="btn btn-primary w-100">Load Students</button>
    </div>

  </div>
</form>

{% if students %}
<!-- SUMMARY -->
<div class="alert alert-info">
  <strong>Total Students:</strong> {{ students|length }}
</div>

<!-- ATTENDANCE FORM -->
<form method="post">
  {% csrf_token %}
  <input type="hidden" name="date" value="{{ selected_date }}">
  <input type="hidden" name="subject" value="{{ selected_subject }}">

  <table class="table table-bordered">
    <thead>
      <tr>
        <th>#</th>
        <th>Student Name</th>
        <th>Present</th>
      </tr>
    </thead>
    <tbody>
      {% for student in students %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ student.user.username }}</td>
        <td>
          <input type="checkbox" name="present_students"
                 value="{{ student.id }}">
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <button class="btn btn-success w-100">
    Submit Attendance
  </button>
</form>
{% endif %}
{% endblock %}
